{
  "id": "65378444-d4f1-44bc-950f-eee9a17180d3",
  "text": {
    "status": "generated",
    "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;http://termx.health/fhir/StructureMap/tobacco-use-to-fhir&quot; = &quot;&quot;\r\n\r\nuses &quot;http://example.org/StructureDefinition/TobaccoUseModel&quot; alias TobaccoUseModel as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; alias Observation as target\r\n\r\ngroup tutorial(source src : TobaccoUseModel, target obs : Observation) {\r\n  src -&gt; obs.id = uuid() &quot;rule_id&quot;;\r\n  src -&gt; obs.status = 'final' &quot;rule_status&quot;;\r\n  src -&gt; obs.category = cc('http://terminology.hl7.org/CodeSystem/observation-category', 'vital-signs', 'Vital Signs') &quot;rule_category&quot;;\r\n  src -&gt; obs.code = cc('http://snomed.info/sct', '229819007', 'Tobacco use and exposure') &quot;rule_code&quot;;\r\n  // src.tulemus as val -&gt; obs.valueCodeableConcept = cc('http://snomed.info/sct', val) &quot;rule_value&quot;;\r\n  src -&gt; obs.value = create('CodeableConcept') as newCC then {\r\n    src -&gt; newCC.coding = create('Coding') as newCoding then {\r\n      src -&gt; newCoding.system = 'http://snomed.info/sct' &quot;rule-value-coding-system&quot;;\r\n      src.tulemus as val -&gt; newCoding.code = val &quot;rule-value-coding-code&quot;;\r\n    } &quot;rule-value-coding&quot;;\r\n  } &quot;rule-value&quot;;\r\n  src.aeg as aeg -&gt; obs.effective = aeg &quot;rule_effectiveTime&quot;;\r\n  src.kommentaar as kom -&gt; obs.note = create('Annotation') as note then {\r\n    kom -&gt; note.text = kom &quot;rule_note_text&quot;;\r\n  } &quot;rule_note&quot;;\r\n  src.patsient as pat -&gt; obs.subject = create('Reference') as subjectRef then {\r\n    pat -&gt;  subjectRef.type = 'Patient',  subjectRef.reference = append('Patient?identifier=', pat) &quot;rule-subref-1&quot;;\r\n  } &quot;rule-subject&quot;;\r\n  src.labiviija as doc -&gt; obs.performer = create('Reference') as docRef then {\r\n    doc -&gt;  docRef.type = 'Practitioner',  docRef.reference = append('Practitioner?identifier=', doc) &quot;rule-docref-1&quot;;\r\n  } &quot;rule-performer&quot;;\r\n}\r\n\r\n</pre></div>"
  },
  "url": "http://termx.health/fhir/StructureMap/tobacco-use-to-fhir",
  "structure": [
    {
      "url": "http://example.org/StructureDefinition/TobaccoUseModel",
      "mode": "source",
      "alias": "TobaccoUseModel"
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/Observation",
      "mode": "target",
      "alias": "Observation"
    }
  ],
  "resourceType": "StructureMap",
  "status": "draft",
  "group": [
    {
      "name": "tutorial",
      "input": [
        {
          "name": "src",
          "type": "TobaccoUseModel",
          "mode": "source"
        },
        {
          "name": "obs",
          "type": "Observation",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule-value",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "obs",
              "element": "value",
              "variable": "newCC",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "CodeableConcept"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule-value-coding",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "newCC",
                  "element": "coding",
                  "variable": "newCoding",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Coding"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule-value-coding-system",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "newCoding",
                      "element": "system",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "http://snomed.info/sct"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule-value-coding-code",
                  "source": [
                    {
                      "context": "src",
                      "element": "tulemus",
                      "variable": "val"
                    }
                  ],
                  "target": [
                    {
                      "context": "newCoding",
                      "element": "code",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "val"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_effectiveTime",
          "source": [
            {
              "context": "src",
              "element": "aeg",
              "variable": "aeg"
            }
          ],
          "target": [
            {
              "context": "obs",
              "element": "effective",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "aeg"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
